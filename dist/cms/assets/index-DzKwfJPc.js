import{K as xe,a1 as pe,a7 as M,a8 as P,D as t,a9 as he,aa as _,ab as be,ac as ye,ad as H,ae as B,af as K,ag as V}from"./index-6uYAaj6y.js";import{r as n}from"./ui-eZO5j9VG.js";import"./vendor-CpMdAPJZ.js";const fe=({category:r,index:f,handleEditCategory:d,handleDeleteCategory:j,isSelected:x,onSelectCategory:i})=>t.jsx(H,{draggableId:`category-${r.id}`,index:f,children:(c,g)=>t.jsxs("div",{ref:c.innerRef,...c.draggableProps,className:`p-4 flex items-center justify-between hover:bg-gray-50 cursor-pointer mb-2 rounded-md bg-gray-50 ${x?"bg-indigo-50 border-l-4 border-indigo-500":""}`,onClick:()=>i(r.id),style:{...c.draggableProps.style,opacity:g.isDragging?.4:1},children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"mr-5 cursor-move",...c.dragHandleProps,children:t.jsx(B,{className:"text-gray-400",size:20})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:r.name||r.title}),t.jsxs("div",{className:"text-sm text-gray-500",children:[r.items," items"]})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{className:"p-1 text-gray-500 hover:text-indigo-600 transition-all",onClick:l=>{l.stopPropagation(),d(r.id)},children:t.jsx(K,{size:18})}),t.jsx("button",{className:"p-1 text-gray-500 hover:text-red-600 transition-all",onClick:l=>{l.stopPropagation(),j(r.id)},children:t.jsx(V,{size:18})})]})]})}),je=({item:r,index:f,handleEditItem:d,handleDeleteItem:j,handleToggleItemSelection:x})=>t.jsx(H,{draggableId:`menu-item-${r.id}`,index:f,children:(i,c)=>t.jsxs("div",{ref:i.innerRef,...i.draggableProps,className:"p-4 flex items-center justify-between hover:bg-gray-50 mb-2 rounded-md bg-gray-50",style:{...i.draggableProps.style,opacity:c.isDragging?.4:1},children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"mr-2 cursor-move",...i.dragHandleProps,children:t.jsx(B,{className:"text-gray-400",size:20})}),t.jsx("input",{type:"checkbox",className:"mr-4 h-5 w-5 border-gray-300 rounded",onChange:()=>x(r.id)}),t.jsx("img",{src:r.image,alt:r.name,className:"w-16 h-16 object-cover mr-4 rounded-md"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:r.name}),t.jsxs("div",{className:"text-sm text-gray-500",children:[r.optionGroups?.length||0," Option Group",(r.optionGroups?.length||0)!==1?"s":""]})]})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("div",{className:"font-medium",children:["RM",r.price.toFixed(2)]}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("button",{className:"p-1 text-gray-500 hover:text-indigo-600 transition-all",onClick:()=>d(r.id),children:t.jsx(K,{size:18})}),t.jsx("button",{className:"p-1 text-gray-500 hover:text-red-600 transition-all",onClick:()=>j(r.id),children:t.jsx(V,{size:18})})]})]})]})});function Se(){const r=xe(),f=pe(),[d,j]=n.useState(null),[x,i]=n.useState(!1),[c,g]=n.useState({}),[l,u]=n.useState({}),[b,k]=n.useState({name:"",price:""}),[m,E]=n.useState(!1),[y,$]=n.useState({name:""}),[C,N]=n.useState([]),[w,A]=n.useState([]),[D,I]=n.useState([]),[J,O]=n.useState(!1),[W,Q]=n.useState(!1),[X,F]=n.useState(!1),[S,z]=n.useState(null),[o,T]=n.useState(null),[G,q]=n.useState(""),[Ne,ve]=n.useState("");n.useEffect(()=>{Z(),Y()},[]),n.useEffect(()=>{if(d){console.log(w);const e=w.filter(s=>s.category&&s.category.some(a=>a.id===d));I(e)}else{const e=w.filter(s=>!s.category||s.category.length===0);I(e)}},[d,w]);const Y=async()=>{i(!0),g(null);try{const s=(await M.getMenuItems()).data?.map(M.transformApiItemToComponent)||[];A(s),ee(s)}catch(e){g(`Failed to load menu items: ${e.message}`),console.error("Error loading menu items:",e)}finally{i(!1)}},Z=async()=>{i(!0),g(null);try{const e=await P.getCategories(),a=(e.data||e.result||e||[]).map(p=>({...p,name:p.name||p.title,title:p.title||p.name,items:0}));N(a)}catch(e){g(`Failed to load categories: ${e.message}`),console.error("Error loading categories:",e)}finally{i(!1)}},ee=e=>{N(s=>s.map(a=>({...a,items:e.filter(p=>p.category&&p.category.some(h=>h.id===a.id)).length})))},te=e=>{j(e)},se=()=>{if(!d)return null;const e=C.find(s=>s.id===d);return e?e.name||e.title:"Unknown Category"},ae=e=>{const{destination:s,source:a,draggableId:p}=e;if(s&&!(s.droppableId===a.droppableId&&s.index===a.index)){if(e.type==="CATEGORIES"){const h=Array.from(C),[R]=h.splice(a.index,1);h.splice(s.index,0,R),N(h)}else if(e.type==="MENU_ITEMS"){const h=Array.from(D),[R]=h.splice(a.index,1);h.splice(s.index,0,R),I(h)}}},L=()=>{k({name:"",price:""}),u({}),z(null),O(!0)};n.useEffect(()=>{f.state?.setShowAddQuickModal&&(L(),r(f.pathname,{replace:!0,state:null}))},[f.state]);const re=()=>{r("/menu/item/add_item")},ne=e=>{const s=C.find(a=>a.id===e);T(s),$({name:s.name||s.title}),Q(!0)},ie=e=>{r(`/menu/item/edit_item/${e}`)},le=e=>{const s=C.find(a=>a.id===e);T(s),q("category"),F(!0)},de=e=>{const s=D.find(a=>a.id===e);z(s),q("item"),F(!0)},oe=e=>{I(s=>s.map(a=>a.id===e?{...a,selected:!a.selected}:a)),A(s=>s.map(a=>a.id===e?{...a,selected:!a.selected}:a))},ce=()=>{const e={};return b.name.trim()||(e.name="Item name is required"),b.price.trim()?(isNaN(parseFloat(b.price))||parseFloat(b.price)<0)&&(e.price="Please enter a valid price"):e.price="Price is required",u(e),Object.keys(e).length===0},U=(e,s)=>{k(a=>({...a,[e]:s})),l[e]&&u(a=>({...a,[e]:""}))},me=async()=>{if(ce()){E(!0);try{const e={title:b.name.trim(),price:parseFloat(b.price),status:"active"},s=await M.createQuickMenuItem(e);k({name:"",price:""}),u({}),v(),window.location.reload()}catch(e){console.error("Error creating item:",e),e.message.includes("duplicate")||e.message.includes("already exists")?u({name:"An item with this name already exists"}):u({general:e.message||"Failed to create item. Please try again."})}finally{E(!1)}}},ge=async()=>{if(!y.name.trim()){u({category:"Please enter a category name"});return}E(!0),u({});try{if(o){const e=await P.updateCategory(o.id,{title:y.name.trim(),description:o.description||"",status:o.status||"active"});N(s=>s.map(a=>a.id===o.id?{...a,name:y.name.trim(),title:y.name.trim()}:a))}else{const e=await P.createCategory({title:y.name.trim(),description:"",status:"active"}),s={id:e.data?.id||e.result?.id||Date.now(),name:y.name.trim(),title:y.name.trim(),items:0};N(a=>[...a,s])}v()}catch(e){console.error("Error saving category:",e),u({category:e.message||"Failed to save category"})}finally{E(!1)}},v=()=>{Q(!1),O(!1),F(!1),z(null),T(null),g(null),u({}),k({name:"",price:""}),$({name:""})},ue=async()=>{if(G==="category"&&o){i(!0);try{await P.deleteCategory(o.id),N(e=>e.filter(s=>s.id!==o.id)),d===o.id&&j(null),A(e=>e.filter(s=>s.categoryId!==o.id))}catch(e){console.error("Error deleting category:",e),g(`Failed to delete category: ${e.message}`)}finally{i(!1)}}else if(G==="item"&&S){i(!0);try{await M.deleteMenuItem(S.id),I(e=>e.filter(s=>s.id!==S.id)),A(e=>e.filter(s=>s.id!==S.id)),N(e=>e.map(s=>s.id===S.categoryId?{...s,items:s.items-1}:s))}catch(e){g(`Failed to delete item: ${e.message}`),console.error("Error deleting item:",e)}finally{i(!1)}}v()};return t.jsxs(he,{onDragEnd:ae,children:[t.jsxs("div",{className:"p-2",children:[c&&t.jsxs("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:[typeof c=="string"?c:Object.values(c).map((e,s)=>t.jsx("div",{children:e},s)),t.jsx("button",{onClick:()=>g(null),className:"ml-2 text-red-500 hover:text-red-700",children:"Ã—"})]}),x&&t.jsx("div",{className:"mb-4 p-3 bg-blue-100 border border-blue-400 text-blue-700 rounded",children:"Loading..."}),t.jsx("div",{className:"flex justify-end mb-6",children:t.jsxs("button",{className:"bg-indigo-900 text-white px-6 py-2.5 rounded-md flex items-center text-[14px] disabled:opacity-50",onClick:re,disabled:x,children:[t.jsx("span",{className:"mr-1",children:"+"})," Add New Item"]})}),t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[t.jsxs("div",{className:"w-full lg:w-1/2 bg-white rounded-md border border-gray-200",children:[t.jsx("div",{className:"bg-indigo-900 p-4 rounded-t-md",children:t.jsx("h2",{className:"text-[16px] text-white text-center",children:"Category"})}),t.jsx(_,{droppableId:"categories",type:"CATEGORIES",children:e=>t.jsxs("div",{className:"p-4 max-h-80 overflow-y-scroll",ref:e.innerRef,...e.droppableProps,children:[C.filter(Boolean).map((s,a)=>t.jsx(fe,{category:s,index:a,handleEditCategory:ne,handleDeleteCategory:le,isSelected:d===s.id,onSelectCategory:te,sortIcon:t.jsx(be,{size:16})},s.id)),e.placeholder]})}),t.jsx("div",{className:"p-4 pt-2 mb-2 mt-3 flex justify-center",children:t.jsxs("button",{className:"bg-indigo-900 text-white px-6 py-2 rounded-md flex items-center disabled:opacity-50",onClick:()=>Q(!0),disabled:x,children:[t.jsx("span",{className:"mr-1",children:"+"})," Add Quick Category"]})}),t.jsx("div",{className:"p-4",children:t.jsxs("div",{className:`p-4 ml-2 mb-2 rounded-md bg-gray-50 cursor-pointer hover:bg-gray-100 ${d===null?"bg-indigo-50 border-l-4 border-indigo-500":""}`,onClick:()=>j(null),children:[t.jsx("div",{className:"font-medium",children:"Other's Items"}),t.jsxs("div",{className:"text-sm text-gray-500",children:[w.filter(e=>!e.category||e.category.length===0).length," Items"]})]})})]}),t.jsxs("div",{className:"w-full lg:w-1/2 bg-white rounded-md border border-gray-200",children:[t.jsx("div",{className:"bg-indigo-900 p-4 rounded-t-md",children:t.jsx("h2",{className:"text-[16px] text-white text-center",children:d?`Items - ${se()}`:"All Items"})}),t.jsx(_,{droppableId:"menu-items",type:"MENU_ITEMS",children:e=>t.jsxs("div",{className:"p-4 max-h-[440px] overflow-y-scroll",ref:e.innerRef,...e.droppableProps,children:[D.length===0?t.jsx("div",{className:"text-center py-10 text-gray-500",children:x?"Loading items...":"No items found. Add some items!"}):D.map((s,a)=>t.jsx(je,{item:s,index:a,handleEditItem:ie,handleDeleteItem:de,handleToggleItemSelection:oe},s.id)),e.placeholder]})}),t.jsx("div",{className:"p-2 mt-3 flex justify-center",children:t.jsxs("button",{className:"bg-indigo-900 text-white px-8 py-2 mb-5 rounded-md flex items-center disabled:opacity-50",onClick:L,disabled:x,children:[t.jsx("span",{className:"mr-1",children:"+"})," Add Quick Item"]})})]})]}),W&&t.jsx("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white border shadow-xl rounded-md p-6 w-full max-w-md",children:[t.jsx("h2",{className:"text-lg font-medium text-center mb-4",children:o?"Edit Category":"Add New Category"}),l.category&&t.jsx("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-md text-sm",children:l.category}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category Name"}),t.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded-md p-2",value:y.name,onChange:e=>$({name:e.target.value}),disabled:m,placeholder:"Enter category name"})]}),t.jsxs("div",{className:"flex justify-center space-x-5",children:[t.jsx("button",{className:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",onClick:v,disabled:m,children:"Cancel"}),t.jsx("button",{className:`px-4 py-2 bg-indigo-900 text-white rounded-md transition-colors ${m?"opacity-50 cursor-not-allowed":"hover:bg-indigo-800"}`,onClick:ge,disabled:m,children:m?"Saving...":o?"Update":"Add"})]})]})}),J&&t.jsx("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white border shadow-xl rounded-md p-6 w-full max-w-md",children:[t.jsx("h2",{className:"text-lg font-medium text-center mb-4",children:"Add Quick Item"}),l.general&&t.jsx("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-md text-sm",children:l.general}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Item Name"}),t.jsx("input",{type:"text",value:b.name,onChange:e=>U("name",e.target.value),className:`w-full border rounded-md p-2 ${l.name?"border-red-500 focus:border-red-500":"border-gray-300 focus:border-indigo-500"} focus:outline-none focus:ring-1 focus:ring-indigo-500`,placeholder:"Enter item name",disabled:m}),l.name&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.name}),t.jsx("label",{className:"block text-sm font-medium mt-3 text-gray-700 mb-1",children:"Price"}),t.jsx("input",{type:"number",step:"0.01",min:"0",value:b.price,onChange:e=>U("price",e.target.value),className:`w-full border rounded-md p-2 ${l.price?"border-red-500 focus:border-red-500":"border-gray-300 focus:border-indigo-500"} focus:outline-none focus:ring-1 focus:ring-indigo-500`,placeholder:"0.00",disabled:m}),l.price&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.price})]}),t.jsxs("div",{className:"flex justify-center space-x-5",children:[t.jsx("button",{className:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",onClick:v,disabled:m,children:"Cancel"}),t.jsx("button",{className:`px-4 py-2 bg-indigo-900 text-white rounded-md transition-colors ${m?"opacity-50 cursor-not-allowed":"hover:bg-indigo-800"}`,onClick:me,disabled:m,children:m?"Adding...":"Add Item"})]})]})})]}),t.jsx(ye,{isOpen:X,onClose:v,onConfirm:ue})]})}export{Se as default};
