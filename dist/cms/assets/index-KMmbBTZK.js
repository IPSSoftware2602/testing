import{K as te,L as j,D as e,X as w,M as $,N as A,O as se,P as ae}from"./index-6uYAaj6y.js";import{r as l}from"./ui-eZO5j9VG.js";import"./vendor-CpMdAPJZ.js";const re=({orderId:v})=>{const[u,N]=l.useState(null),[p,m]=l.useState(!1),[c,f]=l.useState(null),h=async()=>{m(!0),f(null);try{const n=await j.getOrderDelivery(v);n&&n.tracking_link&&N(n.tracking_link)}catch(n){f(n.message||"Failed to load tracking link"),console.error(n)}finally{m(!1)}};return l.useEffect(()=>{h()},[v]),p?e.jsx(A,{className:"h-4 w-4 animate-spin text-gray-500"}):c?e.jsx(w,{className:"h-4 w-4 text-red-500"}):u?e.jsx("a",{href:u,target:"_blank",rel:"noopener noreferrer",className:"p-2 hover:bg-gray-100 rounded inline-block",onClick:n=>n.stopPropagation(),children:e.jsx(ae,{size:16,className:"text-blue-500 hover:text-blue-700"})}):e.jsx("span",{className:"text-gray-400",children:"-"})},de=()=>{const[v,u]=l.useState([]),[N,p]=l.useState([]),[m,c]=l.useState(null),[f,h]=l.useState(!1),n=l.useRef(null),y=l.useRef([]),[x,F]=l.useState({totalSales:0,totalOrders:0}),[k,E]=l.useState([]),[z,O]=l.useState(!1),[D,S]=l.useState(""),[b,g]=l.useState({page:1,perPage:10,total:0}),[d,B]=l.useState("Today"),[I,W]=l.useState({Today:0,Pending:0,Completed:0}),H=["Today","Pending","Completed"],V=te(),R={Today:"all",Pending:"pending",Completed:["completed","delivered"]},T=t=>{const a=new Date(t),o=new Date;return a.getDate()===o.getDate()&&a.getMonth()===o.getMonth()&&a.getFullYear()===o.getFullYear()};l.useEffect(()=>{q(),J()},[d]),l.useEffect(()=>{const t=setInterval(()=>{K()},3e3);return()=>clearInterval(t)},[d]);const X=()=>{n.current&&(n.current.currentTime=0,n.current.loop=!0,n.current.play().catch(t=>console.error("Sound play error:",t)),h(!0))},Y=()=>{n.current&&(n.current.pause(),n.current.currentTime=0,n.current.loop=!1,h(!1))},K=async()=>{try{const t=await j.getCustomerOrderList(),a=R[d],i=t.filter(r=>d==="Today"?T(r.created_at):Array.isArray(a)?a.includes(r.status):r.status===a).map(r=>({id:r.id,orderDate:r.created_at,orderType:r.order_type,status:r.status,selected_date:r.selected_date,selected_time:r.selected_time,paymentStatus:r.payment_status,subtotalAmount:`RM${r.subtotal_amount}`,discountAmount:`RM${r.discount_amount}`,taxAmount:`RM${r.tax_amount}`,deliveryFee:`RM${r.delivery_fee}`,grandTotal:`RM${r.grand_total}`,notes:r.notes||"-"})),s=i.map(r=>r.id),_=s.filter(r=>!y.current.includes(r));if(_.length>0&&y.current.length>0){const r=i.filter(C=>_.includes(C.id));E(C=>[...C,...r].filter((Q,U,Z)=>U===Z.findIndex(ee=>ee.id===Q.id))),O(!0),S(`${_.length} new order(s) received!`),X(),setTimeout(()=>{S("")},5e3)}u(i),p(i),g(r=>({...r,total:i.length})),M(t),y.current=s,c(null)}catch(t){console.error("Auto-refresh failed:",t)}},q=async()=>{c(null);try{const t=await j.getCustomerOrderList(),a=R[d],i=t.filter(s=>d==="Today"?T(s.created_at):Array.isArray(a)?a.includes(s.status):s.status===a).map(s=>({id:s.id,orderDate:s.created_at,orderType:s.order_type,status:s.status,selected_date:s.selected_date,selected_time:s.selected_time,paymentStatus:s.payment_status,subtotalAmount:`RM${s.subtotal_amount}`,discountAmount:`RM${s.discount_amount}`,taxAmount:`RM${s.tax_amount}`,deliveryFee:`RM${s.delivery_fee}`,grandTotal:`RM${s.grand_total}`,notes:s.notes||"-"}));u(i),p(i),g({...b,total:i.length}),M(t),y.current=i.map(s=>s.id)}catch(t){c(t.message||"Failed to load orders")}},M=t=>{const a={Today:t.filter(o=>T(o.created_at)).length,Pending:t.filter(o=>o.status==="pending").length,Completed:t.filter(o=>["completed","delivered"].includes(o.status)).length};W(a)},G=t=>{B(t),g(a=>({...a,page:1}))},J=async()=>{try{const t=await j.getCustomerOrderList(),a=t.reduce((i,s)=>i+parseFloat(s.grand_total),0),o=t.length;F({totalSales:a,totalOrders:o})}catch(t){console.error("Failed to load summary data:",t)}},L=[{name:"Order Type",selector:t=>t.orderType,sortable:!0,width:"150px",cell:t=>{const a=k.some(o=>o.id===t.id);return e.jsxs("div",{className:"relative",children:[t.orderType,a&&e.jsx("span",{className:"absolute -top-2 -right-2",children:e.jsxs("span",{className:"relative flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-red-500"})]})})]})}},{name:"Order Date",selector:t=>new Date(t.orderDate).toLocaleString(),sortable:!0,width:"200px"},{name:"Tracking Link",cell:t=>e.jsx(re,{orderId:t.id}),width:"150px",ignoreRowClick:!0,center:!0},{name:"Pickup/Delivery Time",selector:t=>`${t.selected_date} ${t.selected_time}`,sortable:!0,width:"200px",cell:t=>{const a=`${t.selected_date} ${t.selected_time}`,s=new Date(a)>new Date;return e.jsxs("div",{className:`${s?"font-semibold text-blue-600":""}`,children:[t.selected_date," ",t.selected_time,s&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-blue-100 text-blue-800 text-xs rounded-full",children:"Future"})]})}},{name:"Status",selector:t=>t.status,sortable:!0,width:"120px",cell:t=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${t.status==="pending"?"bg-yellow-100 text-yellow-800":["completed","delivered"].includes(t.status)?"bg-green-100 text-green-800":t.status==="confirmed"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:t.status})},{name:"Payment Status",selector:t=>t.paymentStatus,sortable:!0,width:"170px",center:!0,cell:t=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${t.paymentStatus==="paid"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.paymentStatus})},{name:"Total",selector:t=>t.grandTotal,sortable:!0,width:"100px",cell:t=>e.jsx("span",{className:"font-semibold",children:t.grandTotal})},{name:"Actions",center:!0,cell:t=>e.jsx("div",{className:"flex space-x-2",children:e.jsx("button",{className:"p-2 hover:bg-gray-100 rounded",onClick:()=>V(`/orders/order_lists/order_overview/${t.id}`),title:"View Details",children:e.jsx(se,{size:16,className:"text-gray-600"})})}),width:"100px"}],P={header:{style:{backgroundColor:"#1A237E",color:"#ffffff",fontSize:"14px",fontWeight:"600",padding:"16px",minHeight:"56px"}},headRow:{style:{backgroundColor:"#1A237E",color:"#ffffff",fontSize:"14px",fontWeight:"600",borderBottom:"1px solid #e5e7eb"}},headCells:{style:{color:"#ffffff",backgroundColor:"#1A237E",fontSize:"14px",fontWeight:"600",paddingLeft:"16px",paddingRight:"16px"}},rows:{style:{fontSize:"14px",color:"#374151","&:nth-of-type(odd)":{backgroundColor:"#f9fafb"},"&:hover":{backgroundColor:"#f3f4f6"}}},cells:{style:{paddingLeft:"16px",paddingRight:"16px",paddingTop:"12px",paddingBottom:"12px"}}};return e.jsxs("div",{className:"p-6",children:[e.jsx("audio",{ref:n,src:"/traveloka.mp3",preload:"auto",loop:!0}),D&&e.jsx("div",{className:"fixed top-4 right-4 z-50 animate-bounce",children:e.jsxs("div",{className:"bg-green-500 text-white px-4 py-2 rounded shadow-lg flex items-center",children:[e.jsx("span",{children:D}),e.jsx("button",{onClick:()=>S(""),className:"ml-2",children:e.jsx(w,{size:16})})]})}),f&&e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsx("button",{onClick:Y,className:"px-4 py-2 bg-red-500 text-white rounded shadow hover:bg-red-600",children:"Stop Alert"})}),z&&e.jsxs("div",{className:"mb-6 border border-yellow-300 rounded-lg shadow-lg bg-yellow-50",children:[e.jsxs("div",{className:"p-4 bg-yellow-200 flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold text-yellow-800",children:["New Orders Received ",k.length]}),e.jsx("button",{onClick:()=>O(!1),className:"text-yellow-600 hover:text-yellow-800",children:e.jsx(w,{size:20})})]}),e.jsx("div",{className:"p-4",children:e.jsx($,{columns:L,data:k,customStyles:{...P,header:{style:{backgroundColor:"#F59E0B",color:"#ffffff"}},headRow:{style:{backgroundColor:"#F59E0B",color:"#ffffff"}},headCells:{style:{backgroundColor:"#F59E0B",color:"#ffffff"}}},noDataComponent:e.jsx("div",{className:"py-4 text-center text-gray-500",children:"No new orders to display"})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Sales"}),e.jsxs("p",{className:"text-2xl font-semibold text-gray-900 mt-1",children:["RM",x.totalSales.toFixed(2)]})]}),e.jsx("div",{className:"bg-green-50 p-3 rounded-full",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-3",children:[e.jsxs("span",{className:`${x.totalSales>0?"text-green-600":"text-red-600"}`,children:[x.totalSales>0?"+":"",x.totalOrders," orders"]})," in total"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Orders"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 mt-1",children:x.totalOrders})]}),e.jsx("div",{className:"bg-purple-50 p-3 rounded-full",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-3",children:"All orders in the system"})]})]}),e.jsx("div",{className:"flex gap-4 items-center text-sm font-medium mb-4",children:H.map(t=>e.jsxs("button",{onClick:()=>G(t),className:`px-4 py-1.5 rounded-full border-2 transition ${d===t?"bg-yellow-400 text-white border-yellow-400":"border-transparent text-gray-500"}`,children:[t," ",e.jsx("span",{className:"ml-1",children:I[t]||0})]},t))}),e.jsxs("div",{className:"w-full bg-white shadow-lg rounded-lg",children:[m&&e.jsx("div",{className:"mx-6 mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm text-red-800",children:m})}),e.jsx("button",{onClick:()=>c(null),className:"ml-3 text-red-400 hover:text-red-600",children:e.jsx(w,{className:"h-4 w-4"})})]})}),e.jsx($,{columns:L,data:N,pagination:!0,paginationServer:!0,paginationTotalRows:b.total,paginationDefaultPage:b.page,paginationPerPage:b.perPage,paginationRowsPerPageOptions:[10,20,30,50,100],onChangePage:t=>g(a=>({...a,page:t})),onChangeRowsPerPage:t=>g(a=>({...a,perPage:t,page:1})),progressComponent:e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx(A,{className:"h-8 w-8 animate-spin text-indigo-600"})}),customStyles:P,responsive:!0,striped:!0,highlightOnHover:!0,noDataComponent:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsxs("div",{className:"text-gray-500 text-lg mb-2",children:["No ",d.toLowerCase()," orders found"]}),e.jsx("div",{className:"text-gray-400 text-sm",children:"Try adjusting your filters or search criteria"})]})})]})]})};export{de as default};
